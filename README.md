
# PBL 交互病例（问什么答什么）— 极简可运行版

> 目标：只做“信息收集阶段”的交互窗口。学生提问 → 系统仅返回命中的线索；未提到的不展示。

## 一、准备环境
- 安装 Node.js（建议 18+）
- 下载本项目；在项目根目录运行：
```bash
npm install
cp .env.example .env
# 用你的 DeepSeek API Key 填写 .env 里的 DS_API_KEY
```

## 二、运行
```bash
npm start
```
默认端口为 `http://localhost:8787`。

- 打开 `http://localhost:8787/case/1` → 第一次课（胸痛）
- 打开 `http://localhost:8787/case/2` → 第二次课（呼吸困难/急变）
- 打开 `http://localhost:8787/case/3` → 第三次课（术后心悸/胸闷）

> 首屏仅显示一个最小主诉；其余信息需要学生主动提问才能解锁。未命中只会显示“无相关新信息。”

## 三、怎么玩
- 在页面底部输入问题：如“什么时候开始痛？”、“血压是多少？”、“有心电图吗？”
- 系统每次最多返回 **1 条** 线索（Top-k=1），完全符合“问到什么给什么”。
- 线索文本、同义词与案例编号均在 `data/case_cards.json`（可自行扩充）。

## 四、重要参数（在 .env 配置）
- `DS_API_KEY`：你的 DeepSeek 密钥
- `EMBED_BASE_URL`：嵌入 API 地址（默认 DeepSeek）
- `EMBED_MODEL`：嵌入模型名（示例 `deepseek-embedding-2`，按实际可用改）
- `SIM_THRESHOLD`：相似度阈值（默认 0.40；提高会更严格，降低会更宽松）
- `TOP_K`：Top-k（默认 1，不建议改动）
- `PORT`：端口（默认 8787）

## 五、数据安全与建议
- API Key 只放在 `.env` 本地；**不要**提交到任何代码仓库。
- 需要更强隐私时，可改为**本地嵌入模型**（仅替换 `getEmbedding` 函数）。
- 如需导出课堂记录，可在前端增加“导出对话/已解锁ID”的按钮（可选）。

## 六、扩展方向（非必需）
- 教师控制台：调整阈值/Top-k、查看提问记录、一键解锁。
- 语义+关键词混合路由：加入少量规则词（如 “血压/ECG/BNP/尿量”）做兜底。
- 更细颗粒的线索表：继续补充 `case_cards.json`，一问一事实。

祝课堂顺利！
